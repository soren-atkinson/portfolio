<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Pokémon Team Generator</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        header, footer {
            background-color: #2d72d9;
            color: white;
            padding: 15px 0;
        }
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }
        header a img {
            height: 50px;
        }
        header h1 {
            margin: 0;
            font-size: 24px;
            flex-grow: 1;
            text-align: center;
        }
        nav {
            display: flex;
        }
        nav a {
            color: white;
            text-decoration: none;
            margin: 0 10px;
            font-size: 18px;
        }
        nav a:hover {
            text-decoration: underline;
        }
        main {
            flex: 1;
            text-align: center;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .team {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            justify-items: center;
            margin-top: 20px;
        }
        .pokemon {
            text-align: center;
            width: 200px;
        }
        .pokemon img {
            width: 150px;
            height: 150px;
        }
        .pokemon p {
            font-size: 20px;
            font-weight: bold;
            margin: 10px 0 0;
        }
        footer {
            text-align: center;
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html">
            <img src="logo.png" alt="Site Logo">
        </a>
        <h1>Pokémon Team Builder</h1>
        <nav>
            <a href="customize.html">Customize</a>
            <a href="about.html">About</a>
        </nav>
    </header>

    <main>
        <h2>Random Pokémon Team Generator</h2>
        <button onclick="generateTeam()">Generate Team</button>
        <div class="team" id="team"></div>
    </main>

    <footer>
        <p>&copy; 2024 Pokémon Team Builder. All Rights Reserved.</p>
        <p>Data and images provided by <a href="https://pokeapi.co/" target="_blank" style="color: white;">PokéAPI</a>. Pokémon and Pokémon character names are trademarks of Nintendo.</p>
    </footer>

    <script>
        const API_BASE = "https://pokeapi.co/api/v2/pokemon";
        let allPokemon = [];

        const rules = {
            noDuplicates: true,
            includeLegendaries: true,
            onlySpecificTypes: false,
            selectedType: null
        };

        // Load rules from localStorage
        window.onload = function () {
            const storedRules = localStorage.getItem("pokemonRules");
            if (storedRules) {
                Object.assign(rules, JSON.parse(storedRules));
                console.log("Loaded rules:", rules);
            }
        };

        async function fetchAllPokemon() {
            const url = `${API_BASE}?limit=1008`; // Fetch all Pokémon
            try {
                const response = await fetch(url);
                const data = await response.json();
                allPokemon = data.results;
            } catch (error) {
                console.error("Error fetching Pokémon data:", error);
            }
        }

        function getRandomPokemon() {
            const randomIndex = Math.floor(Math.random() * allPokemon.length);
            return allPokemon[randomIndex];
        }

        async function generateTeam() {
            const teamContainer = document.getElementById("team");
            teamContainer.innerHTML = ""; // Clear previous team
            if (allPokemon.length === 0) {
                await fetchAllPokemon(); // Ensure Pokémon data is loaded
            }
            const team = [];
            while (team.length < 6) {
                const randomPokemon = getRandomPokemon();

                // Fetch detailed Pokémon data
                const pokemonDetails = await fetch(randomPokemon.url).then(res => res.json());

                // Apply rules
                if (rules.noDuplicates && team.some(p => p.name === randomPokemon.name)) continue;
                if (!rules.includeLegendaries && (pokemonDetails.is_legendary || pokemonDetails.is_mythical)) continue;
                if (rules.onlySpecificTypes && !pokemonDetails.types.some(t => t.type.name === rules.selectedType)) continue;

                // Add Pokémon to the team
                team.push(randomPokemon);
                const pokemonDiv = document.createElement("div");
                pokemonDiv.className = "pokemon";
                pokemonDiv.innerHTML = `
                    <img src="${pokemonDetails.sprites.front_default}" alt="${randomPokemon.name}">
                    <p>${randomPokemon.name}</p>
                `;
                teamContainer.appendChild(pokemonDiv);
            }
        }

        // Fetch Pokémon data on page load
        fetchAllPokemon();
    </script>
</body>
</html>
